{% extends "base.html" %}

{% block extra_js %}
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>
<script src="https://maps.googleapis.com/maps/api/js"></script>
<script type="text/javascript" src="/static/js/markerclusterer.js"></script>
<script type="text/javascript" src="/static/js/infobox.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script type="text/javascript">
    var map;
    var markers = [];
    $(document).ready(function () {
        var infowindow = new google.maps.InfoWindow();
        var myLatlng = new google.maps.LatLng({{latitud}}, {{longitud}});
        var myOptions = {
            zoom: 10,
            mapTypeControl: true,
            scaleControl: false,
            scrollwheel: false,
            center: myLatlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);


        $.getJSON("{% url 'obtener-lista' %}", function(data){
            $.each(data, function(i, elemento){
                var latlng = new google.maps.LatLng(elemento.lat, elemento.lon);
                var marker = new google.maps.Marker({
                    position: latlng,
                    map: map,
                    title: elemento.nombre,
                    item: '',
                    id: elemento.id
                });
                markers.push(marker);
            });
            var markerCluster = new MarkerClusterer(map, markers);
        });

    });

</script>
<!-- estos son los graficos de clima y indicadores-->
<script>
    $(function () {
    $('#grafico5').highcharts({
        chart: {
            zoomType: 'xy'
        },
        title: {
            text: 'CLIMA: temperatura promedio y precipitación '
        },
        subtitle: {
            text: '{{request.session.departamento}}'
        },
        xAxis: [{
            categories: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun',
                'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
            crosshair: true
        }],
        yAxis: [{ // Primary yAxis
            labels: {
                format: '{value}°C',
                style: {
                    color: Highcharts.getOptions().colors[1]
                }
            },
            title: {
                text: 'Temperatura',
                style: {
                    color: Highcharts.getOptions().colors[1]
                }
            }
        }, { // Secondary yAxis
            title: {
                text: 'precipitación',
                style: {
                    color: Highcharts.getOptions().colors[0]
                }
            },
            labels: {
                format: '{value} mm',
                style: {
                    color: Highcharts.getOptions().colors[0]
                }
            },
            opposite: true
        }],
        tooltip: {
            shared: true
        },
        legend: {
            layout: 'vertical',
            align: 'left',
            x: 120,
            verticalAlign: 'top',
            y: 100,
            floating: true,
            backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'
        },
        series: [{
            name: 'precipitación',
            type: 'column',
            yAxis: 1,
            data: [{% for obj in lista_precipitacion %} {{obj}},{% endfor %}],
            tooltip: {
                valueSuffix: ' mm'
            }

        }, {
            name: 'Temperatura',
            type: 'spline',
            data: [{% for obj in lista_temperatura %} {{obj}},{% endfor %}],
            tooltip: {
                valueSuffix: '°C'
            }
        }]
    });
});
/**********************************/
$(function () {
    $('#grafico1').highcharts({
        chart: {
            type: 'column'
        },
        title: {
            text: 'PATRÓN DE GASTOS'
        },
        xAxis: {
            categories: ['Gasto en {{request.session.departamento}}']
        },
        yAxis: {
            min: 0,
            title: {
                text: ''
            },
            stackLabels: {
                enabled: true,
                style: {
                    fontWeight: 'bold',
                    color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'
                }
            }
        },
        legend: {
            align: 'center',
            verticalAlign: 'bottom',
            backgroundColor: (Highcharts.theme && Highcharts.theme.background2) || 'white',
            borderColor: '#CCC',
            borderWidth: 1,
            shadow: false
        },
       tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
        plotOptions: {
            column: {
                stacking: 'normal',
                dataLabels: {
                    enabled: true,
                    color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white',
                    style: {
                        textShadow: '0 0 3px black'
                    }
                }
            }
        },
        series: [{
            name: 'Alimentarios',
            data: [{% if gasto_finca == None %}0 {%else%}{{gasto_finca}},{% endif %}]
        }, {
            name: 'No alimentarios',
            data: [{% if gasto_fuera_finca == None %}0 {%else%}{{gasto_fuera_finca}},{% endif %}]
        }]
    });
});


$(function () {
    $('#grafico2').highcharts({
        chart: {
            type: 'column'
        },
        title: {
            text: 'INGRESOS'
        },
        xAxis: {
            categories: ['Ingresos en {{request.session.departamento}}']
        },
        yAxis: {
            min: 0,
            title: {
                text: ''
            },
            stackLabels: {
                enabled: true,
                style: {
                    fontWeight: 'bold',
                    color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'
                }
            }
        },
        legend: {
            align: 'center',
            verticalAlign: 'bottom',
            backgroundColor: (Highcharts.theme && Highcharts.theme.background2) || 'white',
            borderColor: '#CCC',
            borderWidth: 1,
            shadow: false
        },
       tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
        plotOptions: {
            column: {
                stacking: 'normal',
                dataLabels: {
                    enabled: true,
                    color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white',
                    style: {
                        textShadow: '0 0 3px black'
                    }
                }
            }
        },
        series: [{
            name: 'c. tradicionales',
            data: [{% if tradicional == None %}0 {%else%}{{tradicional}},{% endif %}]
        }, {
            name: 'c. huertos',
            data: [{% if huertos == None %}0 {%else%}{{huertos}},{% endif %}]
        }, {
            name: 'o. fuentes',
            data: [{% if fuente == None %}0 {%else%}{{fuente}},{% endif %}]
        },
        {
            name: 'ganado',
            data: [{% if ganado == None %}0 {%else%}{{ganado}},{% endif %}]
        },
        {
            name: 'procesamiento',
            data: [{% if ganado == None %}0 {%else%}{{ganado}}{% endif %},]
        },]
    });
});


$(function () {
    $('#grafico3').highcharts({
        chart: {
            type: 'column'
        },
        title: {
            text: 'Consumo en Kcalorias'
        },
        xAxis: {
            categories: ['Apples', 'Oranges', 'Pears', 'Grapes', 'Bananas']
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Total fruit consumption'
            },
            stackLabels: {
                enabled: true,
                style: {
                    fontWeight: 'bold',
                    color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'
                }
            }
        },
        legend: {
            align: 'right',
            x: -30,
            verticalAlign: 'top',
            y: 25,
            floating: true,
            backgroundColor: (Highcharts.theme && Highcharts.theme.background2) || 'white',
            borderColor: '#CCC',
            borderWidth: 1,
            shadow: false
        },
        tooltip: {
            formatter: function () {
                return '<b>' + this.x + '</b><br/>' +
                    this.series.name + ': ' + this.y + '<br/>' +
                    'Total: ' + this.point.stackTotal;
            }
        },
        plotOptions: {
            column: {
                stacking: 'normal',
                dataLabels: {
                    enabled: true,
                    color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white',
                    style: {
                        textShadow: '0 0 3px black'
                    }
                }
            }
        },
        series: [{
            name: 'John',
            data: [5, 3, 4, 7, 2]
        }, {
            name: 'Jane',
            data: [2, 2, 3, 2, 1]
        }, {
            name: 'Joe',
            data: [3, 4, 4, 2, 5]
        }]
    });
});

$(function () {
    $('#grafico4').highcharts({
        chart: {
            type: 'column'
        },
        title: {
            text: 'GASTOS ALIMENTARIOS'
        },
        xAxis: {
            categories: ['Gasto alimentarios {{request.session.departamento}}']
        },
        yAxis: {
            min: 0,
            title: {
                text: ''
            },
            stackLabels: {
                enabled: true,
                style: {
                    fontWeight: 'bold',
                    color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'
                }
            }
        },
        legend: {
            align: 'center',
            verticalAlign: 'bottom',
            backgroundColor: (Highcharts.theme && Highcharts.theme.background2) || 'white',
            borderColor: '#CCC',
            borderWidth: 1,
            shadow: false
        },
       tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
        plotOptions: {
            column: {
                stacking: 'normal',
                dataLabels: {
                    enabled: true,
                    color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white',
                    style: {
                        textShadow: '0 0 3px black'
                    }
                }
            }
        },
        series: [
        {% for k,v in gastos_alimentarios.items %}
          {
            name: '{{k}}',
            data: [{{v}}]
        },
        {% endfor %}
        ]
    });
});
$(function () {

    $('#arana').highcharts({

        chart: {
            polar: true,
            type: 'line'
        },

        title: {
            text: 'Budget vs spending',
            x: -80
        },

        pane: {
            size: '80%'
        },

        xAxis: {
            categories: ['Sales', 'Marketing', 'Development', 'Customer Support',
                    'Information Technology', 'Administration'],
            tickmarkPlacement: 'on',
            lineWidth: 0
        },

        yAxis: {
            gridLineInterpolation: 'polygon',
            lineWidth: 0,
            min: 0
        },

        tooltip: {
            shared: true,
            pointFormat: '<span style="color:{series.color}">{series.name}: <b>${point.y:,.0f}</b><br/>'
        },

        legend: {
            align: 'right',
            verticalAlign: 'top',
            y: 70,
            layout: 'vertical'
        },

        series: [{
            name: 'Allocated Budget',
            data: [43000, 19000, 60000, 35000, 17000, 10000],
            pointPlacement: 'on'
        }, {
            name: 'Actual Spending',
            data: [50000, 39000, 42000, 31000, 26000, 14000],
            pointPlacement: 'on'
        }]

    });
});
</script>
{% endblock extra_js %}

{% block contenido %}
 <style>
      #map-canvas {
        width: 100%;
        height: 359px;
        margin: 0 auto;
        background-color: #CCC;
      }
    </style>


<div class="row filtros">
    <ol class="breadcrumb">
        <li>SELECCIÓN DE PAÍS</li>
        <li>SELECCIÓN DE DEPARTAMENTO</li>
        <li>INDICADORES POR DEPARTAMENTO</li>

    </ol>
</div>


<div class="contenido-general">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 ">
            <div class="mapa-general ">
                {# mapa #}
                <div id="map-canvas"></div>

                <a class='btn btn-tgeneral center-block' href="/indicadores/">TABLERO DE INDICADORES</a>
            </div>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6  ">
            <div class="table-responsive graficos-general tabla-productor" >
                <table class="table table-hover">

                    <thead>
                        <tr>
                            <th>NOMBRE DE FINCA</th>
                            <th>SEXO</th>
                            <th>DETALLE</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for obj in ahora %}
                        <tr>
                            <td>{{obj.entrevistado.finca}}</td>
                            <td class="sexo">
                                {% if obj.entrevistado.sexo == '2' %}
                                <span class="fa fa-female"> Femenino</span>

                                {% else %}
                                <span class="fa fa-male"> Masculino</span>
                                {% endif %}


                            </td>
                            <td>
                                <a class='btn center-block btn-tabla' href="{% url 'detalle-finca' obj.entrevistado.id %}">Detalle</a>
                            </td>
                        </tr>
                        {% endfor %}

                    </tbody>
                </table>
            </div>
        </div>
    </div>

<!--            <div class="row">
                <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
                    <div class="grafico-indicador" >
                        <div class="titulo-grafico text-right">
                            <a href="#">Ver detalle</a>
                        </div>
                        <div id="grafico1" style="height: 270px;"></div>
                    </div>
                </div>
                <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
                    <div class="grafico-indicador" >
                        <div class="titulo-grafico text-right">
                            <a href="#">Ver detalle</a>
                        </div>
                        <div id="grafico2" style="height: 270px;"></div>
                    </div>
                </div>
            </div>


            <div class="row">
                <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
                    <div class="grafico-indicador" >
                        <div class="titulo-grafico text-right">
                            <a href="#">Ver detalle</a>
                        </div>
                        <div id="grafico3" style="height: 270px;"></div>
                    </div>
                </div>
                <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
                    <div class="grafico-indicador" >
                        <div class="titulo-grafico text-right">
                            <a href="#">Ver detalle</a>
                        </div>
                        <div id="grafico4" style="height: 270px;"></div>
                    </div>
                </div>
            </div>
-->
    <div class="row fila3">
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 ">
            <div class="mapa-general ">
                <div id="grafico1"></div>
            </div>
        </div>
         <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 ">
            <div class="mapa-general ">
                <div id="grafico2"></div>
            </div>
        </div>

    </div>

    <div class="row fila3">
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 ">
            <div class="mapa-general ">
                <div id="grafico3"></div>
            </div>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 ">
            <div class="mapa-general ">
                <div id="grafico4"></div>
            </div>
        </div>

    </div>

    <div class="row fila3">
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 ">
            <div class="mapa-general ">
                <div id="arana"></div>
            </div>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 ">
            <div class="mapa-general ">
                <div id="grafico5"></div>
            </div>
        </div>

    </div>
</div>

<!--





	<div class="row">

    <br>

	</div>
	{# indicadores #}
	<div class="row">
		<h1>indicadores</h1>
	</div>
	{# fichas familia #}
	<div class="row">
		<h1>Miembros familiares</h1>
    {% for obj in ahora %}
      <ul>
        <li>{{obj.entrevistado}} || {{obj.entrevistado.finca}} | <a class='btn' href="{% url 'detalle-finca' obj.entrevistado.id %}">Detalle</a></li>
      </ul>
    {% endfor %}
	</div>
	{# clima #}
	<div class="row">
		<h1>Clima</h1>

	</div>-->
{% endblock contenido %}
